<html>
	<head>
		<script>
			function loadDoc() {
				const xhttp = new XMLHttpRequest();
				xhttp.onload = function() {myFunction(this);}
				xhttp.open("GET", "EstacionesDeServicio.xml");
				xhttp.send();
			}
			function myFunction(xml) {
				const xmlDoc = xml.responseXML;
				const x = xmlDoc.getElementsByTagName("eessprecio");
				let table="<tr><th>Latitud</th><th>Longitud</th></tr>";
				console.log(x.length);//DEBUG
				for (let i = 0; i <x.length; i++) {
					table += "<tr><td>" +
					x[i].getElementsByTagName("latitud")[0].childNodes[0].nodeValue +
					"</td><td>" +
					x[i].getElementsByTagName("longitud_x0020__x0028_wgs84_x0029_")[0].childNodes[0].nodeValue +
					"</td></tr>";
				}
				document.getElementById("resultado").innerHTML = table;
			}
			
			function geolocalizar(){
				const input_latitud = document.getElementById('latitud');
				const input_longitud = document.getElementById('longitud');
				
				fetch('https://ipapi.co/json/')
					.then((response) => response.json())
					.then((data) => {
						console.log(data)
						input_latitud.value = data.latitude;
						input_longitud.value = data.longitude;
					})
					.catch(error => {
						console.error(error);
					});
			}
		</script>
	</head>
	<body onload="geolocalizar()">
		<div id="busqueda">
			<p>Aclaraci√≥n: Por defecto, los campos se rellenan con las coordenadas del cliente obtenidas por su ip.</p>
			<label>Latitud:</label><br>
			<input type="text" id="latitud" name="latitud" value="0"><br>
			<label>Longitud:</label><br>
			<input type="text" id="longitud" name="longitud" value="0"><br><br>
			<button onclick=loadDoc()>Buscar</button>
		</div>
		
		<div id="resultado">
		</div>
	</body>
</html>
